# 灰度任务基本操作<a name="istio_01_0037"></a>

## 修改灰度策略<a name="section098520913581"></a>

如果您需要修改已创建的灰度发布任务的流量策略，可以基于以下步骤。

1.  登录应用服务网格控制台，选择需要创建灰度发布的网格名称，在左侧导航栏中选择“灰度发布“。
2.  单击需要修改灰度任务的“配置流量策略”，重新进行参数配置。参数设置请参照[创建灰度发布](https://support.huaweicloud.com/usermanual-istio/istio_01_0036.html#section1)的参数设置。
3.  单击“策略下发“，灰度策略会自动生效。

## 切换灰度策略类型<a name="section1198719955819"></a>

您可以在“基于请求内容“的策略和“基于流量比例“的策略之间切换。策略完成切换后，原本配置的规则将全部失效，所有的流量，会根据配置的新策略重新分配。

>![](public_sys-resources/icon-notice.gif) **须知：** 
>只有**发布中**的任务才支持灰度策略变更，版本发布完成后（即新版本完全接管旧版本流量，且旧版本已下线），将不支持重新配置灰度策略。

1.  登录应用服务网格控制台，选择需要创建灰度发布的网格名称，在左侧导航栏中选择“灰度发布“。
2.  单击需要修改灰度任务的“配置流量策略”。
3.  参照[创建灰度发布](https://support.huaweicloud.com/usermanual-istio/istio_01_0036.html#section1)重新配置灰度策略。
4.  配置完成后，单击“策略下发”。

## 切为全流量接管<a name="section124701017142211"></a>

执行原版本或灰度版本后的“全流量接管“，原版本或灰度版本将接管全部流量。

1.  登录应用服务网格控制台，选择需要创建灰度发布的网格名称，在左侧导航栏中选择“灰度发布“。
2.  单击需要修改灰度任务的“监测与处理”。
3.  单击版本后的“全流量接管”，此版本即可接管全部流量。

>![](public_sys-resources/icon-note.gif) **说明：** 
>对灰度版本的相关操作，其原理是修改Istio的destinationrule和virtualservice两个资源的配置信息，修改完成后，需要等待10秒左右，新的策略规则才会生效。

## 结束灰度任务<a name="section315312842215"></a>

当新创建的灰度版本接管全流量，您可选择结束灰度任务。

1.  登录应用服务网格控制台，选择需要创建灰度发布的网格名称，在左侧导航栏中选择“灰度发布“。
2.  单击需要修改灰度任务的“监测与处理”。
3.  单击新建灰度版本后的“全流量接管”，此版本即可接管全部流量。
4.  单击“结束灰度任务”，结束的灰度任务可到[已结束灰度任务](https://support.huaweicloud.com/usermanual-istio/istio_01_0037.html#section7)中查看，状态显示为发布成功。

## 取消灰度任务<a name="section14397841183619"></a>

当原版本接管全流量，您可选择取消灰度任务。或单击需要取消灰度任务的  ![](figures/zh-cn_image_0000001176445091.png)按钮，即可取消灰度任务。

1.  登录应用服务网格控制台，选择需要创建灰度发布的网格名称，在左侧导航栏中选择“灰度发布“。
2.  单击需要取消灰度任务的“监测与处理”。
3.  单击原版本后的“全流量接管”，此版本即可接管全部流量。
4.  单击“取消灰度任务”，取消的灰度任务可到[已结束灰度任务](https://support.huaweicloud.com/usermanual-istio/istio_01_0037.html#section7)中查看，状态显示为发布取消。

## 已结束灰度任务<a name="section15383135483517"></a>

取消的灰度任务，以及结束的灰度任务均可在“已结束灰度任务”查看。

1.  登录应用服务网格控制台，选择需要创建灰度发布的网格名称，在左侧导航栏中选择“灰度发布“。
2.  单击“已结束灰度任务”页签，您可以查看：发布任务名称、发布结果、服务、发布时长、发布时间，还可以删除已结束的灰度任务。

