# 添加网关<a name="istio_01_0056"></a>

服务网关在微服务实践中可以做到统一接入、流量管控、安全防护、业务隔离等功能。

创建服务网关前，请提前创建好弹性负载均衡。为了更好的与服务网格配合。创建负载均衡时，需要注意确保所选VPC和子网与创建集群时设置的VPC和子网保持一致，详情请参见[创建负载均衡器](https://support.huaweicloud.com/qs-elb/zh-cn_topic_0052569751.html)。

1.  登录应用服务网格控制台，选择已创建好的网格，在左侧导航栏中选择“网关管理“。
2.  在右侧页面，单击“添加网关“，配置对外访问网络参数。

    -   **网关名称**

        新建服务网关的名称，由小写字母、数字、横线（-）和点（.）组成，且必须以字母或数字开头结尾，长度不能超过63个字符

    -   **集群选择**

        选择网关所属的集群。

    -   **负载均衡配置**

        服务网关使用弹性负载均衡服务（ELB）的负载均衡器提供网络访问，支持公网、私网、共享型和独享型。

        负载均衡实例需与当前集群处于相同VPC 。

    -   **监听器配置**

        服务网关为负载均衡器配置监听器，监听器对负载均衡器上的请求进行监听，并分发流量。

        -   **对外协议**

            请根据业务的协议类型选择。支持HTTP、GRPC、TCP、TLS及HTTPS五种协议类型的选择。

        -   **对外端口**

            开放在负载均衡服务地址的端口，可任意指定。

        -   **TLS终止**
            -   配置TLS协议时，可选择开启/关闭TLS终止，开启TLS终止时需要绑定证书，以支持TLS数据传输加密认证。关闭TLS终止时，网关将直接转发加密的TLS数据。

        -   **密钥证书**
            -   配置TLS协议并开启TLS时，需要绑定证书，以支持TLS数据传输加密认证。
            -   配置HTTPS协议时，需要绑定密钥证书。

        -   **TLS最低版本/TLS最高版本**
            -   配置TLS协议并开启TLS终止时，提供TLS最低版本/TLS最高版本的选择。


    ![](figures/unnaming-(45).png)

3.  配置路由参数。

    -   **域名**

        请填写组件对外发布域名。不配置访问地址默认为负载均衡实例IP地址。如果您开启了TLS认证，则必须填写证书内认证域名，以完成SNI域名校验。

    -   **URL匹配规则**
        -   前缀匹配：例如映射URL为/healthz，只要符合此前缀的URL均可访问。例如/healthz/v1，/healthz/v2。
        -   完全匹配：只有完全匹配上才能生效。例如映射URL为/healthz，则必须为此URL才能访问。

    -   **URL**

        服务支持的映射URL，例如/example。

    -   **命名空间**

        服务网关所在的命名空间。

    -   **目标服务**

        添加网关的服务，直接在下拉框中选择。如果配置诊断失败的服务无法选择，需要先进行修复，请根据[手动修复项](https://support.huaweicloud.com/usermanual-istio/istio_01_0060.html)或[自动修复项](https://support.huaweicloud.com/usermanual-istio/istio_01_0065.html)进行修复后才能添加。

    -   **访问端口**

        仅显示匹配对外协议的端口。

    ![](figures/unnaming-(46).png)

4.  配置完成后，单击“确定“。

    网关添加完成后，在左侧导航栏中单击“服务管理”，获取服务外网访问地址


