# 启用Istio服务网格<a name="istio_01_0002"></a>

启用Istio将为您的服务以无侵入的方式提供灵活的服务治理能力。您只需在CCE集群中开启应用服务网格功能，即可实现灰度发布、流量管理、熔断、监控、拓扑、调用链等丰富的服务治理能力。

## 前提条件<a name="section04761337122018"></a>

已创建CCE混合集群，若未创建，请参照[创建混合集群](https://support.huaweicloud.com/usermanual-cce/cce_01_0028.html)创建。

## 操作步骤<a name="section10250194182420"></a>

1.  通过如下两种方式启用应用服务网格：
    -   方式一：登录[应用服务网格](https://console.huaweicloud.com/istio)控制台，在“总览”页单击“购买Istio服务网格”进入启用Istio服务网格页面。

        **图 1**  启用Istio服务网格<a name="fig13191648194413"></a>  
        ![](figures/启用Istio服务网格.png "启用Istio服务网格")

    -   方式二：登录[应用服务网格](https://console.huaweicloud.com/istio)控制台，在“总览 \> 资源总览”下，单击集群名称后的“启用Istio”进行启用。

        **图 2**  启用Istio<a name="fig1328535717147"></a>  
        ![](figures/启用Istio.png "启用Istio")

2.  进入启用Istio服务网格页面，设置相关参数。
    -   **集群**

        选择要启用Istio服务网格功能的集群。

    -   **部署模式**

        不同的部署模式，待配置的参数也有所不同，请以界面实际展示的参数为准。

        -   独享模式：将为您纳管专属节点，用于部署Istio控制面组件，非Istio控制面负载将无法调度到该专属节点上。

            独享模式的Istio控制面与数据面资源隔离，推荐使用。

            独享模式需要您有充足的节点配额和磁盘配额，一个节点需要配备40G系统盘及100G数据盘，高可用模式需要两个节点配额（四个磁盘配额），单点模式需要一个节点配额（两个磁盘配额）。

        -   共享模式：会将Istio控制面组件部署在您的集群节点上，请确保集群内有可用节点，否则无法启用共享模式Istio服务网格。

            共享模式的Istio控制面与数据面未做隔离，可能产生未知问题，生产环境建议您使用独享模式。


    -   **计费模式**

        支持“按需计费“和“包年/包月“模式。包年/包月模式的节点创建后不能删除，如需停止使用，请到[费用中心](https://account.huaweicloud.com/usercenter/#/userindex/retreatManagement)执行退订操作。

    -   **Istio版本**

        指定Istio版本为1.3.0，该版本支持Dubbo协议服务治理。

    -   <a name="li10988165115388"></a>**产品系列**

        当前支持基础版、专业版、企业版三种系列。不同产品系列在支持管理的网格实例规模和功能上存在差异，请根据业务诉求按需选择。

    -   **当前区域**

        指节点实例所在的物理位置。请就近选择靠近您业务的区域，可减少网络时延，提高访问速度；不同区域的云服务产品之间内网互不相通。

    -   **可用区**

        指在同一区域下，电力、网络隔离的物理区域，可用区之间内网互通，不同可用区之间物理隔离。如果您需要提高工作负载的高可靠性，建议您将云服务器创建在不同的可用区。

    -   **集群管理规模**

        服务网格内治理的实例数量，管理规模大小与[产品系列](#li10988165115388)中所选的版本有关。

    -   **应用性能规格**

        集群下应用单Pod实例QPS流量预估值，默认值为50，服务网格会根据需要管理的应用规模和性能诉求给出资源建议。

    -   **高可用**

        Istio启用后，高可用模式与普通模式不可切换，请根据实际使用情况选择。

        -   是，高可用模式将为您创建两个节点，用于Istio控制面多实例部署，多实例能大大的提高Istio控制面可靠性，推荐使用。
        -   否，非高可用模式为单点模式，Istio控制面组件均为单实例，无法提供更高的可靠性保证。

    -   **节点规格**

        选择所需的规格。为确保Istio控制面运行稳定，推荐您使用 4U 8G 或以上规格控制面节点，详情请参见[规格推荐](https://support.huaweicloud.com/productdesc-istio/istio_productdesc_0006.html)。

    -   **节点数量**

        高可用模式下，要求独享节点个数不少于2；非高可用模式下，要求独享节点个数只能为1。

    -   **控制面实例数量**

        控制面实例数必须和独享节点数相同，每个独享节点上运行控制面的一个实例副本。

    -   **登录方式**

        支持密码和密钥两种方式。

        -   选择“密码“：用户名默认为“root”，请输入登录节点的密码，并确认密码。

            登录节点时需要使用该密码，请妥善管理密码，系统无法获取您设置的密码内容。

        -   选择“密钥对“：在选项框中选择用于登录本节点的密钥对，并单击勾选确认信息。

            密钥对用于远程登录节点时的身份认证。若没有密钥对，可单击选项框右侧的“创建密钥对”来新建，创建密钥对操作步骤请参见[创建密钥对](https://support.huaweicloud.com/usermanual-ecs/zh-cn_topic_0014250631.html)。

    -   **节点配额**

        此处为节点配额提示，如需申请更多配额，请单击[申请扩大配额](https://console.huaweicloud.com/istio/%7B%7BENLARGE_QUOTA_ADDDRESS%7D%7D)。

    -   **购买时长**

        若选择创建“包年/包月”的集群，请设置购买时长。

3.  设置完成后，单击“立即创建”。确认订单无误后，单击“提交”。

    启用时间预计需要5分钟，您可以单击请求提交页面的“返回Istio管理“或“前往CCE集群管理“查看Istio运行状态。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >选择“立即创建”后，会进行启用Istio的操作，期间会操作如下资源：  
    >-   若为独享型，则创建1或2个ECS节点，作为Istio控制面运行节点。  
    >-   创建一个Helm应用编排release对象，作为Istio控制面的资源 。  
    >-   开通ECS节点的安全组，允许7443端口的入流量，使其支持对Pod进行自动注入。  
    >-   为该集群的default的命名空间打上inject=true标签。  

4.  Istio服务网格启用成功后，可在“Istio管理“或CCE的集群列表中查看Istio启用状态。

    **方式一：**

    登录[应用服务网格](https://console.huaweicloud.com/istio)控制台，单击“Istio管理“，在右侧卡片列表中查看Istio状态，若为运行中则说明集群启用Istio成功。

    **图 3**  Istio服务网格启用成功<a name="fig93042151399"></a>  
    ![](figures/Istio服务网格启用成功.png "Istio服务网格启用成功")

    **方式二：**

    登录[云容器引擎](https://console.huaweicloud.com/cce2.0)控制台，单击“资源管理 \> 集群管理”，在右侧集群卡片列表中查看Istio状态。

    -   若集群名称右侧显示![](figures/icon-Istio-l.png)，则Istio启用成功。
    -   若集群名称右侧显示![](figures/icon-Istio-h.png)，则Istio启用失败。


